target_default: 1_get_lake_attr

packages:
  - scipiper
  - dplyr
  - lakeattributes
  - glmtools
  - mda.lakes
  - sf

file_extensions:
  - feather
  - ind

sources:
  - 1_get_lake_attr/src/lake_attr_utils.R
  - 1_get_lake_attr/src/feature_to_cell_coords.R
  - 1_get_lake_attr/src/grid_utils.R
  - 1_get_lake_attr/src/create_nml_tasks.R
  - 1_get_lake_attr/src/create_nml_tasks_makefile.R

targets:
  1_get_lake_attr:
    depends:
      - 1_get_lake_attr/out/glm_nhd_2360642.nml # working with mendota as example

  1_get_lake_attr/in/feature_crosswalk.rds: # lake list from pipeline #1, lake-temperature-model-prep
    command: gd_get('1_get_lake_attr/in/feature_crosswalk.rds.ind')

  1_get_lake_attr/in/lakes_sf.rds: # lake sf object from pipeline #1, lake-temperature-model-prep
    command: gd_get('1_get_lake_attr/in/lakes_sf.rds.ind')

  lake_list: # list of nhd_ids for which to create nml task table
    command: lake_list(crosswalk_file = '1_get_lake_attr/in/feature_crosswalk.rds')

  feature_centroids:
    command: sf_file_centroids("1_get_lake_attr/in/lakes_sf.rds")

  NLDAS_grid: # info from OPeNDAP: https://hydro1.gesdisc.eosdis.nasa.gov/dods/NLDAS_FORA0125_H.002
    command: create_ldas_grid(x0 = I(-124.9375), y0 = I(25.0625), x_num = I(464), y_num = I(224), cell_res = I(0.125))


  nml_tasks:
    command: create_nml_tasks(lake_list)

  1_nml_tasks_makefile.yml:
    command: create_nml_tasks_makefile(
      makefile = target_name,
      task_plan = nml_tasks,
      remake_file = I('1_get_lake_attr.yml'))

# lake Mendota test nml; will eventually go into 1_nml_tasks_makefile.yml
  1_get_lake_attr/out/glm_nhd_2360642.nml: # turn this into a task table for more lakes
    command: get_base_lake_nml(
      nhd_id = I('nhd_2360642'),
      nml_out = target_name)


